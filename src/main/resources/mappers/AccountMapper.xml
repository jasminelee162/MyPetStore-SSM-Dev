<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.csu.mypetstore.persistence.AccountMapper">

    <!-- 查询用户信息 -->
    <select id="getAccountByUsernameAndPassword" parameterType="map" resultType="Account">
        SELECT
            SIGNON.USERNAME,
            ACCOUNT.EMAIL,
            ACCOUNT.FIRSTNAME,
            ACCOUNT.LASTNAME,
            ACCOUNT.STATUS,
            ACCOUNT.ADDR1 AS address1,
            ACCOUNT.ADDR2 AS address2,
            ACCOUNT.CITY,
            ACCOUNT.STATE,
            ACCOUNT.ZIP,
            ACCOUNT.COUNTRY,
            ACCOUNT.PHONE,
            PROFILE.LANGPREF AS languagePreference,
            PROFILE.FAVCATEGORY AS favouriteCategoryId,
            PROFILE.MYLISTOPT AS listOption,
            PROFILE.BANNEROPT AS bannerOption,
            BANNERDATA.BANNERNAME AS bannerName
        FROM
            ACCOUNT,
            PROFILE,
            SIGNON,
            BANNERDATA
        WHERE
            ACCOUNT.USERID = #{username}
          AND SIGNON.PASSWORD = #{password}
          AND SIGNON.USERNAME = ACCOUNT.USERID
          AND PROFILE.USERID = ACCOUNT.USERID
          AND PROFILE.FAVCATEGORY = BANNERDATA.FAVCATEGORY
    </select>

    <!-- 检查用户名是否存在 -->
    <select id="isUsernameExists" parameterType="String" resultType="boolean">
        SELECT COUNT(*) AS usernameCount FROM SIGNON WHERE USERNAME = #{username}
    </select>

    <!-- 插入账户信息 -->
    <insert id="insertAccount" parameterType="Account">
        INSERT INTO ACCOUNT (
            USERID, EMAIL, FIRSTNAME, LASTNAME, STATUS, ADDR1, ADDR2, CITY, STATE, ZIP, COUNTRY, PHONE
        ) VALUES (
                     #{username}, #{email}, #{firstName}, #{lastName}, #{status}, #{address1}, #{address2}, #{city}, #{state}, #{zip}, #{country}, #{phone}
                 )
    </insert>

    <!-- 插入用户配置信息 -->
    <insert id="insertProfile" parameterType="Account">
        INSERT INTO PROFILE (
            USERID, LANGPREF, FAVCATEGORY, MYLISTOPT, BANNEROPT
        ) VALUES (
                     #{username}, #{languagePreference}, #{favouriteCategoryId}, #{listOption}, #{bannerOption}
                 )
    </insert>

    <!-- 插入登录信息 -->
    <insert id="insertSignon" parameterType="Account">
        INSERT INTO SIGNON (USERNAME, PASSWORD) VALUES (#{username}, #{password})
    </insert>

    <!-- 更新账户信息 -->
    <update id="updateAccount" parameterType="Account">
        UPDATE ACCOUNT
        SET
            EMAIL = #{email},
            FIRSTNAME = #{firstName},
            LASTNAME = #{lastName},
            STATUS = #{status},
            ADDR1 = #{address1},
            ADDR2 = #{address2},
            CITY = #{city},
            STATE = #{state},
            ZIP = #{zip},
            COUNTRY = #{country},
            PHONE = #{phone}
        WHERE
            USERID = #{username}
    </update>

    <!-- 更新用户配置信息 -->
    <update id="updateProfile" parameterType="Account">
        UPDATE PROFILE
        SET
            LANGPREF = #{languagePreference},
            FAVCATEGORY = #{favouriteCategoryId},
            MYLISTOPT = #{listOption},
            BANNEROPT = #{bannerOption}
        WHERE
            USERID = #{username}
    </update>

    <!-- 更新登录信息 -->
    <update id="updateSignon" parameterType="Account">
        UPDATE SIGNON
        SET
            PASSWORD = #{password}
        WHERE
            USERNAME = #{username}
    </update>
</mapper>